# gwcplaywright

## Setup
Create a file called ".env" in the root folder
In it, put:
```
GALAXY=FMGNZDEV
PASSWORD="{get this from someone who knows}"
```
In a terminal window, run `npm i` to install the node modules

### VSCode extensions
Install extensions needed for Visual Studio Code
+ Cucumber
+ Document This
+ Playwright Test for VSCode
+ Prettier - Code formatter
+ ESLint

Settings for the Cucumber extension are already included in the repo. Please do not commit any other workspace settings changes.

### Playwright configs
The Playwright test runner can detect multiple config files and projects, which are needed for utilising the Xray reporter, but this can interfere with running and debugging tests locally. To disable the playwrightxray.config:<br>
1. press `F1` to open the Command Palette
2. enter "toggle playwright configs"
3. deselect `playwrightxray.config.ts`

## bddgen
`bddgen` is a node package used to generate Playwright tests from Cucumber feature files. Using this package with Cucumber gives us all the convenience of autocomplete Gherkin steps, looking up step defintions, generating step code snippets, etc. alongside all of the funtionality of Playwright.<br>
To generate the Playwright tests from the feature files, in a terminal run:
`npx bddgen`

This will generate the spec.js files in the .features-gen folder, and they can then be run via the test tab in or from the gutter in the generated spec file.

## File structure
`config` folder contains json files that specify configuration such as environments<br>
`.features-gen` folder is generated by the bddgen package and contains the generated spec files<br>
`playwright-report` contains the report generated by Playwright when tests are run<br>
`tests` contains the bulk of the functionality, broken up as follows:<br>

`bdd` contains the feature files and step definitions, following the same folder structure as the `pages` folder<br>
`data` contains json files that are imported during tests<br>
`fixtures` contains the fixture files used for page object models and functions that span multiple pages<br>
`models` contains definitions of classes for logical "units" such as a contact or an address<br>
`nonbdd` contains tests written in pure Playwright form<br>
`pages` contains the page object models, broken up as follows:<br>

`generic` contains components re-used on multiple pages from different centers, including `basePage.ts`, which is the highest level representation of a page; anything in this file will be included in every page object via inheritance<br>
Everything else is split by center or login<br>

Each center contains a generic `{center}Page.ts` file which extends the `basePage` class, where common elements for that center can be defined, such as `headerNav`, as well as components re-used on multiple pages within the center<br>

The structure is then broken down according to the tabs at the top of the center page, such as `desktop`, `account`, `policy`, etc. The page objects are included here for each of the pages that exist within that tab

## Fixtures as page object models and functions
Playwright uses a system called fixtures which allow for easy and succinct setup in the tests. Fixtures are what are defined in the test setup like so:
```
test("This is a test", async ({ page }) => {
  await page.getByRole("button", { name: "Submit" });
});
```
In this example, `page` is an out-of-the-box fixture. Fixtures allow the test to only reference what is needed. In this framework, fixtures have been added to represent page objects and also functions that span across multiple pages.<br>
When creating a new page object class, it will need to be added to the `pageFixtures.ts` file in the `fixtures` folder.<br>
When adding functions, if the function is performed entirely on one page, add the function to that page object class. Otherwise, it will need to be added to the `actionFixtures.ts` file.

## CI/CD
When run in a pipeline, environment variables will need to be set for Xray's credentials:
```
XRAY_CLIENT_ID={not stored here}
XRAY_SECRET={not stored here}
```
The Xray reporter can be utilised without sending the results to Xray by setting an environment variable:
```
DRYRUN=true
```
(Note that the environment variable value is a string and the actual dryRun parameter only checks for truthiness, meaning that `DRYRUN=false` will actually evaluate as true)

## Roadmap
Things yet to be implemented:
+ API testing
+ github actions workflows
+ integration with GuideWire TeamCity via Bring Your Own Testing
+ video tutorials
